(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{122:function(e,t,n){e.exports=n(308)},127:function(e,t,n){},162:function(e,t){},164:function(e,t){},189:function(e,t){},232:function(e,t){},306:function(e,t,n){},308:function(e,t,n){"use strict";n.r(t);var a,r,s=n(0),i=n.n(s),u=n(115),c=n.n(u),l=(n(127),n(7)),o=n.n(l),p=n(14),d=n(116),m=n(117),h=n(120),y=n(118),f=n(121),v=n(119),b=n.n(v),g=[{constant:!1,inputs:[{name:"_recipient",type:"address"}],name:"openChannel",outputs:[],payable:!0,stateMutability:"payable",type:"function"},{constant:!0,inputs:[],name:"channelIndex",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"",type:"address"}],name:"recipientChannelIndex",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"",type:"address"},{name:"",type:"uint256"}],name:"recipientChannels",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"",type:"address"}],name:"senderChannelIndex",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"",type:"address"},{name:"",type:"uint256"}],name:"senderChannels",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"_channelSpend",type:"uint256"},{name:"_channelId",type:"uint256"},{name:"_signature",type:"bytes"},{name:"_sender",type:"address"}],name:"closeChannel",outputs:[{name:"success",type:"bool"}],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{name:"",type:"uint256"}],name:"channels",outputs:[{name:"id",type:"uint256"},{name:"sender",type:"address"},{name:"recipient",type:"address"},{name:"deposit",type:"uint256"},{name:"status",type:"string"}],payable:!1,stateMutability:"view",type:"function"},{inputs:[],payable:!1,stateMutability:"nonpayable",type:"constructor"}],E=(n(306),{address:"",openPaymentRecipient:"",openPaymentAmount:"",senderChannels:[],recipientChannels:[],paymentAmountEth:"0.01",status:"ready"}),w=function(e){function t(){var e,n;Object(d.a)(this,t);for(var a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return(n=Object(h.a)(this,(e=Object(y.a)(t)).call.apply(e,[this].concat(r)))).state=Object.assign({},E),n}return Object(f.a)(t,e),Object(m.a)(t,[{key:"componentDidMount",value:function(){this.initWeb3()}},{key:"initWeb3",value:function(){if("undefined"!==typeof window.web3)return a=new b.a(window.web3.currentProvider),window.web3=a,this.loadContractInterface();alert("no web3")}},{key:"loadContractInterface",value:function(){return r=new a.eth.Contract(g,"0x4b5614a05fe4a1d212d2d66573909342e5648c1c"),this.setAccount()}},{key:"setAccount",value:function(){var e=Object(p.a)(o.a.mark(function e(){var t,n,r=this;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.eth.getAccounts();case 2:if((t=e.sent)[0]){e.next=5;break}return e.abrupt("return");case 5:n=t[0].toLowerCase(),this.setState({address:n},function(){r.getSenderChannels(),r.getRecipientChannels(),a.currentProvider.publicConfigStore.on("update",function(e){return r.refreshAccount(e)})});case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"refreshAccount",value:function(e){var t=this;if(e.selectedAddress!==this.state.address){var n=Object.assign({},E);this.setState(n,function(){return t.setAccount()})}}},{key:"getSenderChannels",value:function(){var e=Object(p.a)(o.a.mark(function e(){var t,n,a,s,i,u;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.state.address,e.next=3,r.methods.senderChannelIndex(t).call();case 3:if(!((n=e.sent)<1)){e.next=6;break}return e.abrupt("return");case 6:a=[],s=0;case 8:if(!(s<n)){e.next=19;break}return e.next=11,r.methods.senderChannels(t,s).call();case 11:return i=e.sent,e.next=14,r.methods.channels(i).call();case 14:u=e.sent,a.push(u);case 16:s++,e.next=8;break;case 19:this.setState({senderChannels:a});case 20:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getRecipientChannels",value:function(){var e=Object(p.a)(o.a.mark(function e(){var t,n,a,s,i,u;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.state.address,e.next=3,r.methods.recipientChannelIndex(t).call();case 3:if(!((n=e.sent)<1)){e.next=6;break}return e.abrupt("return");case 6:a=[],s=0;case 8:if(!(s<n)){e.next=19;break}return e.next=11,r.methods.recipientChannels(t,s).call();case 11:return i=e.sent,e.next=14,r.methods.channels(i).call();case 14:u=e.sent,a.push(u);case 16:s++,e.next=8;break;case 19:this.setState({recipientChannels:a});case 20:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"openChannel",value:function(){var e=Object(p.a)(o.a.mark(function e(t){var n,s,i,u,c,l=this;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t.preventDefault(),n=this.state,s=n.openPaymentRecipient,i=n.openPaymentAmount,u=n.address,c=a.utils.toWei(i,"ether"),this.setState({status:"busy"}),r.methods.openChannel(s).send({from:u,value:c}).then(function(e){l.getSenderChannels(),l.setState({status:"ready"})});case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"initPayment",value:function(){var e=Object(p.a)(o.a.mark(function e(t){var n,r,s,i,u,c,l,p,d;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.state,r=n.paymentAmountEth,s=n.address,i=a.utils.toWei(r,"ether"),u=this.getPreviousChannelSpend(t),c=(parseInt(i)+parseInt(u)).toString(),l=this.constructPaymentMessage(c,t),e.next=7,this.signPaymentMessage(l);case 7:p=e.sent,d={channelId:t,channelSpend:c,signature:p,spenderAddress:s},this.storePayment(d);case 10:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"constructPaymentMessage",value:function(e,t){return a.utils.soliditySha3({t:"uint256",v:e},{t:"uint256",v:t})}},{key:"signPaymentMessage",value:function(){var e=Object(p.a)(o.a.mark(function e(t){var n,r;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.state.address,e.next=3,a.eth.personal.sign(t,n);case 3:return r=e.sent,e.abrupt("return",r);case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getPreviousChannelSpend",value:function(e){if(!localStorage.getItem("payments"))return localStorage.setItem("payments",JSON.stringify({})),0;var t=JSON.parse(localStorage.getItem("payments"));return(t[e]?t[e].channelSpend:0).toString()}},{key:"storePayment",value:function(e){var t=localStorage.getItem("payments")?Object.assign({},JSON.parse(localStorage.getItem("payments"))):{};t[e.channelId]=e,localStorage.setItem("payments",JSON.stringify(t)),this.getSenderChannels()}},{key:"verifySignature",value:function(){var e=Object(p.a)(o.a.mark(function e(t){var n,r,s,i,u,c;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=JSON.parse(localStorage.getItem("payments"))[t],r=n.channelSpend,s=n.signature,i=n.spenderAddress,u=this.constructPaymentMessage(r,t),e.next=5,a.eth.personal.ecRecover(u,s);case 5:if((c=e.sent).toLowerCase()!==i.toLowerCase()){e.next=8;break}return e.abrupt("return",alert("payment signature is valid. Signed by: "+c+" for "+r));case 8:alert("payment signature invalid");case 9:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"closeChannel",value:function(){var e=Object(p.a)(o.a.mark(function e(t){var n,a,s,i,u,c,l=this;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.state.address,(a=localStorage.getItem("payments")?Object.assign({},JSON.parse(localStorage.getItem("payments"))):{})[t]){e.next=4;break}return e.abrupt("return");case 4:s=a[t],i=s.channelSpend,u=s.signature,c=s.spenderAddress,this.setState({status:"busy"}),r.methods.closeChannel(i,t,u,c).send({from:n}).then(function(e){l.setState({status:"ready"}),!0===e.status&&(l.getSenderChannels(),l.getRecipientChannels())});case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this,t=this.state,n=t.address,r=t.openPaymentRecipient,s=t.openPaymentAmount,u=t.senderChannels,c=t.recipientChannels,l=t.paymentAmountEth,o=t.status;return i.a.createElement("div",{className:"App"},!n&&i.a.createElement("div",{className:"App__overlay"},i.a.createElement("h3",null,"Please sign into MetaMask"),i.a.createElement("h1",null,"psss.. test on rinkeby network")),"busy"===o&&i.a.createElement("div",{className:"App__overlay"},i.a.createElement("h3",null,"Blockchaining, please wait.."),i.a.createElement("h1",null,"this is why we need channels XD"),i.a.createElement("h3",null,"Please confirm with your metamask wallet")),i.a.createElement("div",{className:"App__header"},i.a.createElement("h1",null,"++"),i.a.createElement("p",null,"signed in: ",n)),i.a.createElement("div",{className:"App__container"},i.a.createElement("h4",null,"Open payment channel"),i.a.createElement("form",null,i.a.createElement("label",null,"Enter Channel Recipient",i.a.createElement("input",{type:"text",placeholder:"recipient address 0x..",value:r,onChange:function(t){return e.setState({openPaymentRecipient:t.target.value})}})),i.a.createElement("label",null,"Enter Channel Value",i.a.createElement("input",{type:"text",placeholder:"amount in ETH",value:s,onChange:function(t){return e.setState({openPaymentAmount:t.target.value})}})),i.a.createElement("button",{className:"App__button--primary",onClick:function(t){return e.openChannel(t)}},"Open Channel")),i.a.createElement("br",null),i.a.createElement("hr",null),i.a.createElement("h4",null,"Sender channels"),i.a.createElement("form",null,i.a.createElement("label",null,"Enter Payment Amount",i.a.createElement("input",{type:"text",placeholder:"amount in ETH",value:l,onChange:function(t){return e.setState({paymentAmountEth:t.target.value})}}))),i.a.createElement("br",null),u.length>0&&i.a.createElement("div",null,u.map(function(t){return i.a.createElement("div",{key:t.id},a.utils.fromWei(e.getPreviousChannelSpend(t.id).toString())," \xa0 | \xa0",a.utils.fromWei(t.deposit.toString(),"ether")," ETH \xa0",t.recipient," \xa0\xa0\xa0\xa0\xa0\xa0","closed"===t.status&&i.a.createElement("span",null,"closed"),"open"===t.status&&i.a.createElement("span",null,i.a.createElement("button",{className:"App__button--secondary",onClick:function(){return e.initPayment(t.id)}},"pay ",l," ETH"),i.a.createElement("button",{className:"App__button--secondary",onClick:function(){return e.verifySignature(t.id)},disabled:0===e.getPreviousChannelSpend(t.id)},"verify")),i.a.createElement("br",null),i.a.createElement("br",null))})),!u.length&&i.a.createElement("div",null,"-"),i.a.createElement("br",null),i.a.createElement("hr",null),i.a.createElement("h4",null,"Recieving channels"),c.length>0&&i.a.createElement("div",null,c.map(function(t){return i.a.createElement("div",{key:t.id},a.utils.fromWei(e.getPreviousChannelSpend(t.id).toString())," \xa0 | \xa0",a.utils.fromWei(t.deposit.toString(),"ether")," ETH \xa0",t.sender," \xa0\xa0\xa0\xa0\xa0\xa0","closed"===t.status&&i.a.createElement("span",null,"closed"),"open"===t.status&&i.a.createElement("span",null,i.a.createElement("button",{className:"App__button--secondary",onClick:function(){return e.verifySignature(t.id)},disabled:0===e.getPreviousChannelSpend(t.id)},"verify"),i.a.createElement("button",{className:"App__button--secondary",onClick:function(){return e.closeChannel(t.id)},disabled:0===e.getPreviousChannelSpend(t.id)},"close channel")),i.a.createElement("br",null),i.a.createElement("br",null))})),!c.length&&i.a.createElement("div",null,"-")))}}]),t}(s.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(i.a.createElement(w,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[122,2,1]]]);
//# sourceMappingURL=main.58eb1b11.chunk.js.map