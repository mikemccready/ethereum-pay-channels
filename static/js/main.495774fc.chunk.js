(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{122:function(e,n,t){e.exports=t(312)},127:function(e,n,t){},162:function(e,n){},164:function(e,n){},189:function(e,n){},232:function(e,n){},306:function(e,n,t){},308:function(e,n,t){},310:function(e,n,t){},312:function(e,n,t){"use strict";t.r(n);var a=t(0),r=t.n(a),s=t(115),i=t.n(s),c=(t(127),t(6)),u=t.n(c),o=t(14),l=t(116),p=t(117),m=t(120),d=t(118),h=t(121),y=t(119),f=t.n(y),v=[{constant:!1,inputs:[{name:"_recipient",type:"address"}],name:"openChannel",outputs:[],payable:!0,stateMutability:"payable",type:"function"},{constant:!0,inputs:[],name:"channelIndex",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"",type:"address"}],name:"recipientChannelIndex",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"",type:"address"},{name:"",type:"uint256"}],name:"recipientChannels",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"",type:"address"}],name:"senderChannelIndex",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"",type:"address"},{name:"",type:"uint256"}],name:"senderChannels",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"_channelSpend",type:"uint256"},{name:"_channelId",type:"uint256"},{name:"_signature",type:"bytes"},{name:"_sender",type:"address"}],name:"closeChannel",outputs:[{name:"success",type:"bool"}],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{name:"",type:"uint256"}],name:"channels",outputs:[{name:"id",type:"uint256"},{name:"sender",type:"address"},{name:"recipient",type:"address"},{name:"deposit",type:"uint256"},{name:"status",type:"string"}],payable:!1,stateMutability:"view",type:"function"},{inputs:[],payable:!1,stateMutability:"nonpayable",type:"constructor"}];t(306);var b=function(e){var n=e.address;return r.a.createElement("div",{className:"Header"},r.a.createElement("h1",null,"++"),r.a.createElement("p",null,"signed in: ",n))};t(308);var g=function(e){var n=e.display;return r.a.createElement("div",{className:"Overlay"},r.a.createElement("div",{className:"Overlay__pattern"}),"signin"===n&&r.a.createElement("div",{className:"Overlay__content"},r.a.createElement("h3",null,"Please sign into\xa0",r.a.createElement("a",{target:"_blank",href:"https://metamask.io/",rel:"noopener noreferrer"},"MetaMask")),r.a.createElement("h1",null,"psss.. test on rinkeby network")),"busy"===n&&r.a.createElement("div",{className:"Overlay__content"},r.a.createElement("h3",null,"Blockchaining, please standby.."),r.a.createElement("h1",null,"Confirm with your metamask wallet")))};var C=function(e){var n=e.openPaymentRecipient,t=e.openPaymentAmount,a=e.openChannel,s=e.handleFormChange;return r.a.createElement("form",{onSubmit:function(e){return e.preventDefault()}},r.a.createElement("label",null,"Enter Channel Recipient",r.a.createElement("input",{type:"text",placeholder:"recipient address 0x..",value:n,onChange:function(e){return s("openPaymentRecipient",e.target.value)}})),r.a.createElement("label",null,"Enter Channel Value",r.a.createElement("input",{type:"text",placeholder:"amount in ETH",value:t,onChange:function(e){return s("openPaymentAmount",e.target.value)}})),r.a.createElement("button",{className:"App__button--primary",onClick:a},"Open Channel"))};var E,w,S=function(e){var n=e.channel,t=e.channelSpend,a=e.closeChannel,s=e.userType,i=e.verifySignature,c=e.paymentAmountEth,u=e.initPayment,o=window.web3;return r.a.createElement("div",null,o.utils.fromWei(t)," \xa0 | \xa0",o.utils.fromWei(n.deposit.toString(),"ether")," ETH \xa0","sender"===s?n.recipient:n.sender,"\xa0\xa0\xa0\xa0\xa0\xa0","closed"===n.status&&r.a.createElement("span",null,"closed"),"open"===n.status&&r.a.createElement("span",null,"sender"===s?r.a.createElement("button",{className:"App__button--secondary",onClick:function(){return u(n.id)}},"pay ",c," ETH"):r.a.createElement("button",{className:"App__button--secondary",onClick:function(){return a(n.id)},disabled:0===t},"close channel"),r.a.createElement("button",{className:"App__button--secondary",onClick:function(){return i(n.id)},disabled:0===t},"verify")),r.a.createElement("br",null),r.a.createElement("br",null))},x=(t(310),"0x4b5614a05fe4a1d212d2d66573909342e5648c1c"),k={address:"",openPaymentRecipient:"",openPaymentAmount:"",senderChannels:[],recipientChannels:[],paymentAmountEth:"0.01",status:"ready"},A=function(e){function n(){var e,t;Object(l.a)(this,n);for(var a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return(t=Object(m.a)(this,(e=Object(d.a)(n)).call.apply(e,[this].concat(r)))).state=Object.assign({},k),t.initWeb3=function(){"undefined"!==typeof window.web3?(E=new f.a(window.web3.currentProvider),window.web3=E,t.handleAccountUpdate(),t.loadContractInterface()):alert("\n        Please download metamask extension and sign-in\n        to continue.\n        ")},t.loadContractInterface=function(){w=new E.eth.Contract(v,x),t.setAccount()},t.handleAccountUpdate=function(){E.currentProvider.publicConfigStore.on("update",function(e){return t.refreshAccount(e)})},t.setAccount=Object(o.a)(u.a.mark(function e(){var n,a;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,E.eth.getAccounts();case 2:if((n=e.sent)[0]){e.next=5;break}return e.abrupt("return");case 5:a=n[0].toLowerCase(),t.setState({address:a},function(){t.getSenderChannels(),t.getRecipientChannels()});case 7:case"end":return e.stop()}},e,this)})),t.refreshAccount=function(e){if(e.selectedAddress!==t.state.address){var n=Object.assign({},k);t.setState(n,function(){return t.setAccount()})}},t.getSenderChannels=Object(o.a)(u.a.mark(function e(){var n;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getContractChannels(w.methods.senderChannelIndex,w.methods.senderChannels);case 2:n=e.sent,t.setState({senderChannels:n});case 4:case"end":return e.stop()}},e,this)})),t.getRecipientChannels=Object(o.a)(u.a.mark(function e(){var n;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getContractChannels(w.methods.recipientChannelIndex,w.methods.recipientChannels);case 2:n=e.sent,t.setState({recipientChannels:n});case 4:case"end":return e.stop()}},e,this)})),t.getContractChannels=function(){var e=Object(o.a)(u.a.mark(function e(n,a){var r,s,i,c,o,l,p;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.state.address,s=w.methods.channels,i=[],e.next=5,n(r).call();case 5:if(!((c=e.sent)<1)){e.next=8;break}return e.abrupt("return",[]);case 8:o=0;case 9:if(!(o<c)){e.next=20;break}return e.next=12,a(r,o).call();case 12:return l=e.sent,e.next=15,s(l).call();case 15:p=e.sent,i.push(p);case 17:o++,e.next=9;break;case 20:return e.abrupt("return",i);case 21:case"end":return e.stop()}},e,this)}));return function(n,t){return e.apply(this,arguments)}}(),t.openChannel=Object(o.a)(u.a.mark(function e(){var n,a,r,s,i;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=t.state,a=n.openPaymentRecipient,r=n.openPaymentAmount,s=n.address,i=E.utils.toWei(r,"ether"),t.setState({status:"busy"}),w.methods.openChannel(a).send({from:s,value:i}).then(function(e){t.getSenderChannels(),t.setState({status:"ready"})});case 4:case"end":return e.stop()}},e,this)})),t.initPayment=function(){var e=Object(o.a)(u.a.mark(function e(n){var a,r,s,i,c,o,l,p,m;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.state,r=a.paymentAmountEth,s=a.address,i=E.utils.toWei(r,"ether"),c=t.getPreviousChannelSpend(n),o=(parseInt(i)+parseInt(c)).toString(),l=t.constructPaymentMessage(o,n),e.next=7,t.signPaymentMessage(l);case 7:p=e.sent,m={channelId:n,channelSpend:o,signature:p,spenderAddress:s},t.storePayment(m);case 10:case"end":return e.stop()}},e,this)}));return function(n){return e.apply(this,arguments)}}(),t.constructPaymentMessage=function(e,n){return E.utils.soliditySha3({t:"uint256",v:e},{t:"uint256",v:n})},t.signPaymentMessage=function(){var e=Object(o.a)(u.a.mark(function e(n){var a,r;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.state.address,e.next=3,E.eth.personal.sign(n,a);case 3:return r=e.sent,e.abrupt("return",r);case 5:case"end":return e.stop()}},e,this)}));return function(n){return e.apply(this,arguments)}}(),t.getPreviousChannelSpend=function(e){if(!localStorage.getItem("payments"))return"0";var n=JSON.parse(localStorage.getItem("payments"));return(n[e]?n[e].channelSpend:0).toString()},t.storePayment=function(e){var n=localStorage.getItem("payments")?Object.assign({},JSON.parse(localStorage.getItem("payments"))):{};n[e.channelId]=e,localStorage.setItem("payments",JSON.stringify(n)),t.getSenderChannels()},t.verifySignature=function(){var e=Object(o.a)(u.a.mark(function e(n){var a,r,s,i,c,o;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=JSON.parse(localStorage.getItem("payments"))[n],r=a.channelSpend,s=a.signature,i=a.spenderAddress,c=t.constructPaymentMessage(r,n),e.next=5,E.eth.personal.ecRecover(c,s);case 5:if((o=e.sent).toLowerCase()!==i.toLowerCase()){e.next=10;break}return e.abrupt("return",alert("payment signature is valid. Signed by: "+o+" for "+r));case 10:alert("payment signature invalid");case 11:case"end":return e.stop()}},e,this)}));return function(n){return e.apply(this,arguments)}}(),t.closeChannel=function(){var e=Object(o.a)(u.a.mark(function e(n){var a,r,s,i,c,o;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.state.address,(r=localStorage.getItem("payments")?Object.assign({},JSON.parse(localStorage.getItem("payments"))):{})[n]){e.next=4;break}return e.abrupt("return");case 4:s=r[n],i=s.channelSpend,c=s.signature,o=s.spenderAddress,t.setState({status:"busy"}),w.methods.closeChannel(i,n,c,o).send({from:a}).then(function(e){t.setState({status:"ready"}),!0===e.status&&(t.getSenderChannels(),t.getRecipientChannels())});case 7:case"end":return e.stop()}},e,this)}));return function(n){return e.apply(this,arguments)}}(),t.handleFormChange=function(e,n){var a={};a[e]=n,t.setState(a)},t}return Object(h.a)(n,e),Object(p.a)(n,[{key:"componentDidMount",value:function(){this.initWeb3()}},{key:"render",value:function(){var e=this,n=this.state,t=n.address,a=n.openPaymentRecipient,s=n.openPaymentAmount,i=n.senderChannels,c=n.recipientChannels,u=n.paymentAmountEth,o=n.status;return r.a.createElement("div",{className:"App"},r.a.createElement(b,{address:t}),r.a.createElement("div",{className:"App__container"},r.a.createElement("h4",null,"Open payment channel"),r.a.createElement(C,{openPaymentRecipient:a,openPaymentAmount:s,handleFormChange:this.handleFormChange,openChannel:this.openChannel}),r.a.createElement("hr",null),r.a.createElement("h4",null,"Sender channels"),r.a.createElement("form",null,r.a.createElement("label",null,"Enter Payment Amount",r.a.createElement("input",{type:"text",placeholder:"amount in ETH",value:u,onChange:function(n){return e.setState({paymentAmountEth:n.target.value})}}))),i.length>0?r.a.createElement("div",null,i.map(function(n){return r.a.createElement(S,{key:n.id,userType:"sender",channel:n,channelSpend:e.getPreviousChannelSpend(n.id),initPayment:e.initPayment,verifySignature:e.verifySignature,paymentAmountEth:u})})):r.a.createElement("div",null," - "),r.a.createElement("hr",null),r.a.createElement("h4",null,"Recieving channels"),c.length>0?r.a.createElement("div",null,c.map(function(n){return r.a.createElement(S,{key:n.id,userType:"reciever",channel:n,channelSpend:e.getPreviousChannelSpend(n.id),closeChannel:e.closeChannel,verifySignature:e.verifySignature})})):r.a.createElement("div",null," - ")),!t&&r.a.createElement(g,{display:"signin"}),"busy"===o&&r.a.createElement(g,{display:"busy"}))}}]),n}(a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(A,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[122,2,1]]]);
//# sourceMappingURL=main.495774fc.chunk.js.map